# Claude Request Forwarder v4.0 Configuration
# v4.0 æ–°ç‰¹æ€§: ç®€åŒ–é…ç½® - ç§»é™¤"ç»„"æ¦‚å¿µ,ç›´æ¥é…ç½®ç«¯ç‚¹å’Œæ•…éšœè½¬ç§»

# å…¨å±€æ—¶åŒºé…ç½®
timezone: "Asia/Shanghai"

# æœåŠ¡å™¨é…ç½®
server:
  host: "0.0.0.0"
  port: 8087

# è·¯ç”±ç­–ç•¥é…ç½®
strategy:
  type: "priority"                  # è·¯ç”±ç­–ç•¥: "priority" (ä¼˜å…ˆçº§) æˆ– "fastest" (æœ€å¿«å“åº”)
  fast_test_enabled: false          # å¯ç”¨å¿«é€Ÿæµ‹è¯• (ä»…åœ¨ fastest ç­–ç•¥ä¸‹ç”Ÿæ•ˆ)

# é‡è¯•é…ç½®
retry:
  max_attempts: 3
  base_delay: "1s"
  max_delay: "30s"
  multiplier: 2.0

# å¥åº·æ£€æŸ¥é…ç½®
health:
  check_interval: "30s"
  timeout: "5s"
  health_path: "/v1/models"

# æ—¥å¿—é…ç½®
logging:
  level: "info"
  format: "text"

# æµå¼ä¼ è¾“é…ç½®
streaming:
  heartbeat_interval: "30s"
  read_timeout: "10s"
  max_idle_time: "120s"
  response_header_timeout: "60s"

# ==================== v4.0 æ•…éšœè½¬ç§»é…ç½® ====================
# ğŸ†• v4.0 æ–°é…ç½®: å–ä»£æ—§çš„ group é…ç½®
# ========================================================
failover:
  enabled: true                    # å¯ç”¨æ•…éšœè½¬ç§»ï¼Œé»˜è®¤: true
  default_cooldown: "10m"          # é»˜è®¤å†·å´æ—¶é—´ï¼Œé»˜è®¤: 10m

# ==================== v3.x å…¼å®¹é…ç½® (å¯é€‰) ====================
# âš ï¸  ä»¥ä¸‹ group é…ç½®å·²å¼ƒç”¨ï¼Œä¿ç•™ä»…ä¸ºå‘åå…¼å®¹
# æ¨èä½¿ç”¨ä¸Šé¢çš„ failover é…ç½®
# å¦‚æœåŒæ—¶å­˜åœ¨ failover å’Œ group é…ç½®ï¼Œä¼˜å…ˆä½¿ç”¨ failover
# ========================================================
# group:
#   cooldown: "10m"                      # è‡ªåŠ¨æ˜ å°„åˆ° failover.default_cooldown
#   auto_switch_between_groups: true     # è‡ªåŠ¨æ˜ å°„åˆ° failover.enabled

# è¯·æ±‚æŒ‚èµ·é…ç½®
request_suspend:
  enabled: false
  timeout: "300s"
  max_suspended_requests: 100

# å…¨å±€è¶…æ—¶é…ç½®
global_timeout: "300s"

# é‰´æƒé…ç½®
auth:
  enabled: false

# TUIç•Œé¢é…ç½®
tui:
  enabled: false
  update_interval: "2s"

# Webç•Œé¢é…ç½®
web:
  enabled: true
  host: "0.0.0.0"
  port: 8088

# Tokenè®¡æ•°é…ç½®
token_counting:
  enabled: true
  estimation_ratio: 4.0

# ä½¿ç”¨è·Ÿè¸ªé…ç½®
usage_tracking:
  enabled: false
  database:
    type: "sqlite"
    path: "data/cc-forwarder.db"

  # ğŸ†• v4.1 çƒ­æ± é…ç½®ï¼ˆå¯é€‰ï¼Œé»˜è®¤å¯ç”¨ï¼‰
  # çƒ­æ± æ¶æ„å°†æ´»è·ƒè¯·æ±‚ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œåªåœ¨å®Œæˆæ—¶å†™å…¥æ•°æ®åº“
  # ä¼˜åŠ¿: å‡å°‘80%æ•°æ®åº“å†™å…¥ï¼Œæå‡100xå®æ—¶æŸ¥è¯¢æ€§èƒ½
  hot_pool:
    enabled: true              # æ˜¯å¦å¯ç”¨çƒ­æ± æ¨¡å¼ï¼Œé»˜è®¤: true
    max_age: "30m"             # è¯·æ±‚æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œè¶…æ—¶è‡ªåŠ¨å½’æ¡£ï¼Œé»˜è®¤: 30m
    max_size: 10000            # çƒ­æ± æœ€å¤§å®¹é‡ï¼Œé»˜è®¤: 10000
    cleanup_interval: "1m"     # åƒµå°¸è¯·æ±‚æ¸…ç†é—´éš”ï¼Œé»˜è®¤: 1m
    archive_on_cleanup: true   # æ¸…ç†æ—¶æ˜¯å¦å½’æ¡£åˆ°æ•°æ®åº“ï¼Œé»˜è®¤: true

# ==================== v4.0 ç«¯ç‚¹é…ç½® ====================
# ğŸ†• v4.0 ç®€åŒ–é…ç½®: ç§»é™¤ group å’Œ group-priority
# ç›´æ¥ä½¿ç”¨ priority å’Œ failover_enabled
# ========================================================
endpoints:
  # ä¼˜å…ˆçº§ 1 ç«¯ç‚¹ (æœ€é«˜ä¼˜å…ˆçº§)
  - name: "instcopilot-sg"
    url: "https://api.instcopilot.com"
    priority: 1                    # ç«¯ç‚¹ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
    failover_enabled: true         # å‚ä¸æ•…éšœè½¬ç§»ï¼Œé»˜è®¤: true
    # cooldown: "5m"               # ç«¯ç‚¹çº§å†·å´æ—¶é—´ï¼ˆå¯é€‰ï¼‰ï¼Œé»˜è®¤ä½¿ç”¨å…¨å±€é…ç½®
    timeout: "300s"
    token: "sk-your-primary-token"
    supports_count_tokens: true    # æ”¯æŒcount_tokensç«¯ç‚¹
    headers:
      anthropic-version: "2023-06-01"

  # ä¼˜å…ˆçº§ 2 ç«¯ç‚¹ (å¤‡ç”¨)
  - name: "openai-us"
    url: "https://api.openai.com"
    priority: 2
    failover_enabled: true         # å‚ä¸æ•…éšœè½¬ç§»
    timeout: "300s"
    token: "sk-your-backup-token"
    supports_count_tokens: false

  # ä¼˜å…ˆçº§ 3 ç«¯ç‚¹ (ç¬¬äºŒå¤‡ç”¨)
  - name: "anthropic-official"
    url: "https://api.anthropic.com"
    priority: 3
    failover_enabled: true
    timeout: "300s"
    token: "sk-your-anthropic-token"
    supports_count_tokens: true

  # ä¸“ç”¨ç«¯ç‚¹ (ä¸å‚ä¸æ•…éšœè½¬ç§»)
  # é€‚ç”¨åœºæ™¯: ä»…ç”¨äºç‰¹å®šæ¨¡å‹ï¼Œä¸å¸Œæœ›ä½œä¸ºå…¶ä»–ç«¯ç‚¹çš„å¤‡ç”¨
  - name: "special-model-only"
    url: "https://special.api.com"
    priority: 1
    failover_enabled: false        # ğŸ”’ ä¸å‚ä¸æ•…éšœè½¬ç§»ï¼ˆä¸“ç”¨ç«¯ç‚¹ï¼‰
    timeout: "300s"
    token: "sk-special-token"
    # æ­¤ç«¯ç‚¹å¤±è´¥ä¸ä¼šåˆ‡æ¢åˆ°å…¶ä»–ç«¯ç‚¹

# ==================== é…ç½®è¿ç§»æŒ‡å— ====================
# v3.x â†’ v4.0 è‡ªåŠ¨è¿ç§»:
#
# v3.x é…ç½® (ä»ç„¶æ”¯æŒ):
# endpoints:
#   - name: "endpoint1"
#     group: "main"          # è‡ªåŠ¨å¿½ç•¥
#     group-priority: 1      # è‡ªåŠ¨æ˜ å°„åˆ° priority
#     priority: 1
#
# group:
#   cooldown: "10m"                      # è‡ªåŠ¨æ˜ å°„åˆ° failover.default_cooldown
#   auto_switch_between_groups: true     # è‡ªåŠ¨æ˜ å°„åˆ° failover.enabled
#
# v4.0 æ–°é…ç½® (æ¨è):
# endpoints:
#   - name: "endpoint1"
#     priority: 1            # ç›´æ¥ä½¿ç”¨ priority
#     failover_enabled: true # æ˜¯å¦å‚ä¸æ•…éšœè½¬ç§»
#
# failover:
#   enabled: true
#   default_cooldown: "10m"
#
# ========================================================

# ==================== ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ ====================
#
# åœºæ™¯1: æ™®é€šæ•…éšœè½¬ç§»
# - è®¾ç½®å¤šä¸ªç«¯ç‚¹,æŒ‰ priority æ’åº
# - æ‰€æœ‰ç«¯ç‚¹ failover_enabled: true
# - failover.enabled: true
# â†’ ç«¯ç‚¹æŒ‰ä¼˜å…ˆçº§æ•…éšœè½¬ç§»
#
# åœºæ™¯2: ä¸“ç”¨ç«¯ç‚¹ï¼ˆä¸å‚ä¸æ•…éšœè½¬ç§»ï¼‰
# - é€šç”¨ç«¯ç‚¹: failover_enabled: true
# - ä¸“ç”¨ç«¯ç‚¹: failover_enabled: false
# â†’ ä¸“ç”¨ç«¯ç‚¹ä»…ç”¨äºç‰¹å®šè¯·æ±‚,å¤±è´¥ä¸åˆ‡æ¢
#
# åœºæ™¯3: ç¦ç”¨å…¨å±€æ•…éšœè½¬ç§»
# - failover.enabled: false
# â†’ ç«¯ç‚¹å¤±è´¥ç›´æ¥è¿”å›é”™è¯¯,ä¸è¿›è¡Œæ•…éšœè½¬ç§»
#
# ========================================================
